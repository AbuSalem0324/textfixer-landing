<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Success - TextFixer</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        .success-container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--spacing-xl) var(--spacing-md);
        }
        
        .success-header {
            text-align: center;
            margin-bottom: var(--spacing-xxl);
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background-color: var(--color-success);
            color: var(--color-white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-lg);
            font-size: 2.5rem;
        }
        
        .plan-comparison {
            background-color: var(--color-tertiary);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
        }
        
        .plan-transition {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-lg);
            gap: var(--spacing-lg);
        }
        
        .plan-box {
            background-color: var(--color-white);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-md);
            text-align: center;
            min-width: 150px;
        }
        
        .plan-box.old {
            opacity: 0.7;
        }
        
        .plan-box.new {
            border: 2px solid var(--color-accent);
            box-shadow: var(--shadow-md);
        }
        
        .arrow {
            font-size: 2rem;
            color: var(--color-accent);
        }
        
        .api-key-container {
            background-color: var(--color-white);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
        }
        
        .api-key {
            background-color: var(--color-tertiary);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-md);
            font-family: monospace;
            font-size: 1.1rem;
            margin: var(--spacing-md) 0;
            word-break: break-all;
            border: 1px solid var(--color-secondary);
        }
        
        .features-container {
            background-color: var(--color-white);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
        }
        
        .features-list {
            list-style: none;
            margin: var(--spacing-md) 0;
        }
        
        .features-list li {
            padding: var(--spacing-sm) 0;
            padding-left: 1.5rem;
            position: relative;
        }
        
        .features-list li:before {
            content: "âœ“";
            color: var(--color-success);
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .instructions {
            background-color: var(--color-white);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
        }
        
        .button-container {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
            flex-wrap: wrap;
        }
        
        .loading-container {
            text-align: center;
            padding: var(--spacing-xxl);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--color-secondary);
            border-top: 4px solid var(--color-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--spacing-md);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-container {
            background-color: var(--color-error);
            color: var(--color-white);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            text-align: center;
        }
        
        .upgrade-section {
            background-color: var(--color-tertiary);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }
        
        .support-note {
            text-align: center;
            margin: var(--spacing-xl) 0;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="logo">
                <h1>TextFixer</h1>
                <p class="tagline">AI-Powered Text Correction</p>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="downloads.html">Downloads</a></li>
                    <li><a href="blog.html">Updates</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="page-header">
        <div class="container">
            <h2>Success!</h2>
            <p>Your TextFixer account has been updated</p>
        </div>
    </section>

    <div class="success-container">
        <!-- Loading State -->
        <div class="loading-container" id="loading-state">
            <div class="loading-spinner"></div>
            <h3>Loading your account details...</h3>
            <p>Please wait while we prepare your TextFixer information.</p>
        </div>

        <!-- Error State -->
        <div class="error-container" id="error-state" style="display: none;">
            <h3>Something went wrong</h3>
            <p id="error-message">We couldn't load your account details. Please contact support.</p>
            <div class="button-container" style="justify-content: center; margin-top: var(--spacing-lg);">
                <a href="contact.html" class="btn btn-secondary">Contact Support</a>
                <a href="index.html" class="btn btn-text">Return to Home</a>
            </div>
        </div>

        <!-- Success State -->
        <div id="success-state" style="display: none;">
            <div class="success-header">
                <div class="success-icon">ðŸŽ‰</div>
                <h2 id="success-title">Welcome to TextFixer!</h2>
                <p id="success-message">Your account has been successfully updated.</p>
            </div>
            
            <!-- Plan Comparison (shown for upgrades) -->
            <div class="plan-comparison" id="plan-comparison" style="display: none;">
                <h3>Plan Change Summary</h3>
                <div class="plan-transition">
                    <div class="plan-box old" id="old-plan">
                        <h4 id="old-plan-name">Loading...</h4>
                        <p id="old-plan-price">Â£0/month</p>
                    </div>
                    <div class="arrow">â†’</div>
                    <div class="plan-box new" id="new-plan">
                        <h4 id="new-plan-name">Loading...</h4>
                        <p id="new-plan-price">Â£0/month</p>
                    </div>
                </div>
            </div>
            
            <!-- Email Notice -->
            <div class="api-key-container">
                <h3>Check Your Email</h3>
                <p>Your TextFixer Access Code has been sent to your email address. You'll need this code to set up TextFixer on your devices.</p>
                <p><strong>Important:</strong> If you don't see the email within a few minutes, please check your spam folder.</p>
            </div>
            
            <!-- Features Container -->
            <div class="features-container">
                <h3 id="features-title">Your Plan Features</h3>
                <ul class="features-list" id="features-list">
                    <!-- Features will be populated by JavaScript -->
                </ul>
            </div>
            
            <!-- Upgrade Section (for free plan users) -->
            <div class="upgrade-section" id="upgrade-section" style="display: none;">
                <h3>Want More?</h3>
                <p>Upgrade to get unlimited text corrections and remove character limits.</p>
                <div class="button-container" style="justify-content: center;">
                    <a href="index.html#pricing" class="btn btn-primary">Upgrade Now</a>
                </div>
            </div>
            
            <!-- Next Steps Instructions -->
            <div class="instructions">
                <h3>Next Steps</h3>
                <ol id="instructions-list">
                    <li>Check your email for your TextFixer Access Code.</li>
                    <li>Download the TextFixer iOS Shortcut using the button below.</li>
                    <li>When prompted during setup, enter your Access Code from the email.</li>
                    <li>Once set up, select any text in any app, tap the share button, and choose TextFixer from the shortcuts menu.</li>
                    <li>Your text will be instantly corrected!</li>
                </ol>
                <div class="button-container">
                    <a href="https://www.icloud.com/shortcuts/a75cd95a8587445c8101602dadd51f5f" class="btn btn-primary">Download iOS Shortcut</a>
                    <a href="downloads.html" class="btn btn-secondary">View Setup Instructions</a>
                </div>
            </div>
            
            <div class="support-note">
                <p>If you have any questions, please contact our support team at <a href="mailto:support@textfixer.com">support@textfixer.com</a></p>
                <a href="index.html" class="btn btn-text">Return to Home</a>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h2>TextFixer</h2>
                    <p>AI-powered text correction in a tap.</p>
                </div>
                
                <div class="footer-links">
                    <div class="link-group">
                        <h4>Product</h4>
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li><a href="index.html#features">Features</a></li>
                            <li><a href="index.html#pricing">Pricing</a></li>
                            <li><a href="downloads.html">Downloads</a></li>
                        </ul>
                    </div>
                    
                    <div class="link-group">
                        <h4>Company</h4>
                        <ul>
                            <li><a href="blog.html">About Us</a></li>
                            <li><a href="blog.html">Updates</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                    
                    <div class="link-group">
                        <h4>Legal</h4>
                        <ul>
                            <li><a href="privacy.html">Privacy Policy</a></li>
                            <li><a href="terms.html">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 TextFixer. All rights reserved.</p>
                <div class="social-links">
                    <a href="#" class="social-link">Twitter</a>
                    <a href="#" class="social-link">LinkedIn</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            const sessionId = urlParams.get('session_id');
            
            if (!userId) {
                showError('Invalid request: User ID missing');
                return;
            }
            
            loadPlanChangeInfo(userId);
            
            // Log the source for analytics
            if (sessionId) {
                console.log('Arrived from Stripe checkout session:', sessionId);
            } else {
                console.log('Direct access to plan change page');
            }
            
            
            // Download shortcut functionality
            document.getElementById('download-shortcut').addEventListener('click', function() {
                // In production, this would download or open the iOS shortcut
                window.location.href = 'https://www.icloud.com/shortcuts/your-shortcut-id';
            });
        });
        
        async function loadPlanChangeInfo(userId) {
            try {
                const response = await fetch(`https://textfixer.onrender.com/plan-change-info/${userId}`);
                
                if (!response.ok) {
                    throw new Error('Failed to load account information');
                }
                
                const data = await response.json();
                displayPlanChangeInfo(data);
            } catch (error) {
                console.error('Error loading plan info:', error);
                showError('Failed to load your account information. Please try again or contact support.');
            }
        }
        
        function displayPlanChangeInfo(data) {
            // Hide loading state
            document.getElementById('loading-state').style.display = 'none';
            
            // Show success state
            document.getElementById('success-state').style.display = 'block';
            
            // Update header
            document.getElementById('success-title').textContent = getSuccessTitle(data.change_type, data.current_plan.name);
            document.getElementById('success-message').textContent = data.message;
            
            
            // Display plan comparison (if upgrade/downgrade)
            if (data.old_plan && data.change_type !== 'renewal') {
                document.getElementById('plan-comparison').style.display = 'block';
                document.getElementById('old-plan-name').textContent = data.old_plan.name;
                document.getElementById('old-plan-price').textContent = `Â£${data.old_plan.price}/month`;
                document.getElementById('new-plan-name').textContent = data.current_plan.name;
                document.getElementById('new-plan-price').textContent = `Â£${data.current_plan.price}/month`;
            }
            
            // Display current plan features
            document.getElementById('features-title').textContent = `${data.current_plan.name} Features`;
            const featuresList = document.getElementById('features-list');
            featuresList.innerHTML = '';
            data.current_plan.features.forEach(feature => {
                const li = document.createElement('li');
                li.textContent = feature;
                featuresList.appendChild(li);
            });
            
            // Show upgrade section for free plan users
            if (data.current_plan.id === 'free') {
                document.getElementById('upgrade-section').style.display = 'block';
            }
            
            // Update instructions for free vs paid plans
            updateInstructions(data.current_plan.id);
        }
        
        function getSuccessTitle(changeType, planName) {
            switch (changeType) {
                case 'upgrade':
                    return `ðŸŽ‰ Upgrade Successful!`;
                case 'downgrade':
                    return `Plan Updated`;
                case 'renewal':
                    return `Subscription Renewed!`;
                case 'new':
                default:
                    return `Welcome to ${planName}!`;
            }
        }
        
        function updateInstructions(planId) {
            const instructionsList = document.getElementById('instructions-list');
            
            if (planId === 'free') {
                // Add note about free plan limits
                const limitNote = document.createElement('li');
                limitNote.innerHTML = '<strong>Note:</strong> Your free plan includes 20 text fixes per month with a 500 character limit per fix.';
                limitNote.style.color = 'var(--color-warning)';
                instructionsList.appendChild(limitNote);
                
                // Add instructions for free plan users
                const upgradeNote = document.createElement('li');
                upgradeNote.innerHTML = 'Want to remove limits? <a href="index.html#pricing" style="color: var(--color-accent);">Upgrade anytime</a> to get unlimited corrections.';
                instructionsList.appendChild(upgradeNote);
            } else {
                // For paid plans, add benefits note
                const benefitsNote = document.createElement('li');
                benefitsNote.innerHTML = '<strong>Enjoy:</strong> Unlimited text corrections with your paid plan!';
                benefitsNote.style.color = 'var(--color-success)';
                instructionsList.appendChild(benefitsNote);
            }
        }
        
        function showError(message) {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('error-state').style.display = 'block';
            document.getElementById('error-message').textContent = message;
        }
    </script>
</body>
</html>